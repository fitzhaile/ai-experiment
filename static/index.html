<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plain JS Chat</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; }
    .container { max-width: 1000px; width: 100%; margin: 2rem auto; padding: 0 1rem; box-sizing: border-box; }
    button { padding: 0.6rem 1rem; font-size: 1rem; margin-top: 20px; }
    pre { background: #f6f8fa; padding: 1rem; border-radius: 8px; white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; width: 100%; box-sizing: border-box; }
    input { width: 100%; max-width: 100%; height: 40px; padding: 0 10px; font-size: 16px; box-sizing: border-box; }
    @media (max-width: 1024px) { .container { margin: 1rem auto; } }
  </style>
  <!--
    This page is a static client that talks to your local Flask API.

    You can open this file directly (file://...) or serve it via any static server.

    How it finds the API:
    - If opened via file://, we assume the dev server is on http://127.0.0.1:8080
    - If served via http(s) on the same host, we use relative paths /api/haiku and /api/chat
  -->
  <script>
    const apiBase = (location.origin.startsWith('file:')) ? 'http://127.0.0.1:8080' : '';

    const logEl = document.getElementById('out');
    const promptEl = document.getElementById('prompt');
    let messages = [
      { role: 'system', content: 'You are a concise assistant that writes clear answers.' }
    ];

    function append(role, content) {
      const who = role === 'user' ? 'You' : 'Assistant';
      const spacer = logEl.textContent.trim().length ? '\n\n' : '';
      logEl.textContent += `${spacer}${who}: ${content}`;
    }

    async function sendChat() {
      const content = promptEl.value.trim() || 'Say hello.';
      promptEl.value = '';
      messages.push({ role: 'user', content });
      append('user', content);
      try {
        const res = await fetch(`${apiBase}/api/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages })
        });
        const data = await res.json();
        const text = (data && data.text) ? data.text : (data && data.error ? 'Error: ' + data.error : '(no response)');
        messages.push({ role: 'assistant', content: text });
        append('assistant', text);
      } catch (e) {
        append('assistant', 'Error: ' + e);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      append('assistant', 'Hi! What would you like to talk about?');
      promptEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendChat();
        }
      });
    });
  </script>
  <!-- You can open this file directly (file://...) thanks to CORS on the Flask server. -->
  <!-- Or serve it via any static server. -->
</head>
<body>
  <div class="container">
    <h1>AI Chat</h1>
    <p>This page calls your local Flask API at <code>/api/chat</code>.</p>
    <input id="prompt" type="text" placeholder="Type a message and press Enter" />
    <button onclick="sendChat()">Send</button>
    <pre id="out">(waiting)</pre>
  </div>
</body>
</html>


